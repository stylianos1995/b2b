<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>B2B API test</title>
  <style>
    body { font-family: sans-serif; max-width: 500px; margin: 2rem auto; padding: 0 1rem; }
    input, button { padding: 0.5rem; margin: 0.25rem 0; width: 100%; box-sizing: border-box; }
    button { background: #333; color: white; border: none; cursor: pointer; }
    pre { background: #f5f5f5; padding: 1rem; overflow: auto; font-size: 12px; }
    .ok { color: green; }
    .err { color: red; }
  </style>
</head>
<body>
  <h1>B2B API â€“ Login</h1>
  <p>Base URL: <input type="text" id="baseUrl" value="http://localhost:3000/v1" style="width: 100%;" /></p>
  <label>Email</label>
  <input type="email" id="email" placeholder="e.g. buyer@mvp.local" value="buyer@mvp.local" />
  <label>Password</label>
  <input type="password" id="password" placeholder="password" value="password" autocomplete="current-password" />
  <p style="font-size: 12px; color: #666;">Seed users: <strong>buyer@mvp.local</strong> / <strong>password</strong> (lowercase).</p>
  <button type="button" id="btnRunSeed">1. Run seed</button>
  <button type="button" id="btnFixPasswords">2. Fix seed passwords (if login still fails)</button>
  <button type="button" id="btnLogin">3. Login</button>
  <h2>Response</h2>
  <pre id="out">Click 1 (Run seed), then 3 (Login). Use buyer@mvp.local / password.</pre>

  <script>
    const baseUrl = () => document.getElementById('baseUrl').value.trim();
    const out = document.getElementById('out');

    document.getElementById('btnRunSeed').onclick = async () => {
      out.textContent = 'Loading (running seed)...';
      out.className = '';
      try {
        const res = await fetch(baseUrl() + '/auth/dev/run-seed', { method: 'POST' });
        const data = await res.json().catch(() => ({}));
        out.textContent = JSON.stringify(data, null, 2);
        out.className = res.ok ? 'ok' : 'err';
      } catch (e) {
        out.textContent = 'Error: ' + e.message;
        out.className = 'err';
      }
    };

    document.getElementById('btnFixPasswords').onclick = async () => {
      out.textContent = 'Loading...';
      out.className = '';
      try {
        const res = await fetch(baseUrl() + '/auth/dev/fix-seed-passwords', { method: 'POST' });
        const data = await res.json().catch(() => ({}));
        out.textContent = JSON.stringify(data, null, 2);
        out.className = res.ok ? 'ok' : 'err';
      } catch (e) {
        out.textContent = 'Error: ' + e.message;
        out.className = 'err';
      }
    };

    document.getElementById('btnLogin').onclick = async () => {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      if (!email || !password) {
        out.textContent = 'Enter email and password.';
        out.className = 'err';
        return;
      }
      const passwordTrimmed = password.trim();
      out.textContent = 'Loading...';
      out.className = '';
      try {
        const res = await fetch(baseUrl() + '/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password: passwordTrimmed }),
        });
        const data = await res.json().catch(() => ({}));
        out.textContent = JSON.stringify(data, null, 2);
        out.className = res.ok ? 'ok' : 'err';
      } catch (e) {
        out.textContent = 'Error: ' + e.message;
        out.className = 'err';
      }
    };
  </script>
</body>
</html>
