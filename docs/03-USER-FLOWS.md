# 3. User Flows

## 3.1 Hospitality Owners (Buyers)

### Onboarding

1. Land on app (web/mobile). See value proposition and “Sign up as business”.
2. Sign up: email + password (or OAuth). Verify email via link.
3. Profile: first name, last name, phone (optional). No business yet.
4. Redirect to “Add your business” or “Complete setup”.

### Business Registration

1. Enter legal name, trading name, business type (restaurant, café, etc.), optional registration number, tax ID.
2. Upload proof (e.g. trade licence, VAT cert) if verification is required. Optional in MVP; required for V1 verification.
3. Submit. Business created in status `pending_verification` or `active` (MVP: often auto-active).
4. User is linked as Owner to the business. Redirect to location setup or dashboard.

### Location Setup

1. Add delivery address: address line, city, region, postal code, country. Optional: geocode (lat/lng) via maps API.
2. Add delivery instructions (e.g. “Back entrance, ring bell”).
3. Set as default delivery address or add more. At least one location required before ordering.
4. Later: edit/delete locations from business settings.

### Supplier Discovery

1. From dashboard or “Find suppliers”, open discovery (search + filters).
2. Filters: geography (postcode/radius or region), category (food, beverage, cleaning, etc.), provider type, min rating, delivery window.
3. Results: list of providers with trading name, rating, delivery info, sample products. Sort by relevance, rating, distance.
4. Click provider → provider profile: catalog summary, availability, ratings, “Add to preferred” / “Place order”.

### Filtering

- Persist filters in URL or local state. Apply to provider list and product search within provider.
- Product-level filters: category, price range, unit. MVP: filters on provider list; in-provider search by text.

### Ordering

1. From provider profile, “Order” or “View catalog”. Browse products (and services if any).
2. Add items to cart (quantity, optional notes per line). Cart shows subtotal, tax estimate, delivery fee if applicable.
3. Select delivery address and requested delivery date/slot (from provider availability).
4. Review order; add order-level notes. Submit. Idempotency key used if retry.
5. Order created in `submitted`; provider can confirm or reject. Buyer sees status in “My orders”.

### Payments

1. When invoice is issued (after delivery or by provider rule): buyer sees “Outstanding invoices” or notification.
2. Open invoice → “Pay”. Redirect to hosted checkout (Stripe) or enter card; confirm. Payment recorded; invoice marked paid.
3. Optional: add payment method in profile for one-click pay later. MVP: pay per invoice with card each time.

### Recurring Orders

1. From “Orders” or provider page: “Set up recurring order”. Choose frequency (e.g. weekly), next delivery date, delivery address, items and quantities.
2. Subscription created; first order generated on next_order_date (or user can “Order now” once).
3. List “Recurring orders”; edit (items, frequency, address) or pause/cancel. Orders generated by background job show in “My orders”.

### Dispute Handling

1. Buyer sees order as delivered but has issue (wrong items, quality). Opens “Support” or “Dispute” from order.
2. Describe issue, attach photos if needed. Dispute created; provider and platform notified.
3. Provider can respond. Admin or automated flow can offer refund (full/partial), replacement, or close. Buyer sees status and outcome in dispute thread.

---

## 3.2 Providers

### Onboarding

1. Sign up: email + password (or OAuth). Verify email.
2. Choose “Register as supplier/provider”. Enter provider details: legal name, trading name, type (wholesaler, roaster, etc.), registration/tax ID.
3. Upload documents if verification required. Submit. Provider created (pending_verification or active).
4. User linked as Owner. Redirect to catalog or dashboard.

### Verification

- Admin reviews documents and profile; approves or rejects. On approval, status → active; provider can receive orders and be discovered. Rejection: reason shown; provider can resubmit. MVP: can skip verification and use self-declared only.

### Catalog Creation

1. “Products” (and “Services” if used). Add product: name, SKU, category, unit, unit size, price, tax rate, optional image, min/max quantity.
2. Save; product is active. Edit/delete (soft delete or is_active = false). Bulk import (CSV) in V1.
3. Services: name, type, price type, price. Attach to orders as delivery fee or separate line in V1.

### Availability Management

1. “Availability” or “Delivery settings”. Add window: day of week, start time, end time; optional valid_from/valid_until.
2. Optionally set service area: list of postcodes or radius from warehouse. Orders outside area or outside windows are not accepted (or shown as unavailable in discovery).
3. Override: block specific dates (e.g. bank holiday). MVP: simple weekly windows; overrides in V1.

### Order Handling

1. New order notification (in-app, email). Open “Orders” → list filtered by status (new, confirmed, preparing, shipped, delivered).
2. Open order: view lines, delivery address, requested slot. Actions: Confirm, Reject (with reason), or Update status (e.g. preparing → shipped).
3. On confirm: order status → confirmed; buyer notified. On reject: order cancelled; buyer notified and can reorder elsewhere.
4. When dispatching: set delivery to “in_transit”, add tracking if available. On delivery: set “delivered”, optional proof. Buyer and system updated.

### Logistics Handling

- If provider uses own drivers: manual status updates (scheduled, in_transit, delivered). If third-party carrier: optional integration to pull tracking and update Delivery entity. MVP: manual updates only.

### Invoicing

1. After delivery (or by rule): “Create invoice” from order or “Invoices” → “New”. Select order(s), review lines, set due date. Issue.
2. Invoice status → issued; buyer sees it and can pay. Optional: auto-invoice on delivery (job creates invoice when order status = delivered).
3. List invoices; filter by status. When payment received, invoice → paid (webhook or manual match in MVP).

### Payouts

- Platform runs payout job (e.g. weekly): for each provider, sum paid invoices minus platform fee, trigger transfer via Stripe Connect (or bank). Provider sees “Payouts” history: date, amount, status. MVP: can be manual or simple weekly batch; full automation in V1.
