# MVP API Skeleton

## HTTP endpoints for Mini-MVP capabilities

All endpoints map to capabilities in the MVP Feature Map (11). Only MVP capabilities with a client-facing or internal API are listed. Internal-only capabilities (Resolve principal, Create delivery, Deliver notification) have no endpoint row.

**Conventions:** Base path `/v1`. All mutation responses return the created/updated resource or id + timestamps. Scope (buyer vs provider) is derived from `Authorization` and membership; no path segment for "me". Idempotency: `Idempotency-Key` header on POST where specified.

---

## API skeleton table

| Capability                                | Service                  | HTTP Method | Endpoint                           | Request Fields                                                                                                                                                                        | Response Fields                                                                                                                                                                      | Role(s)                                                                                      | Triggered Event(s)                 | Priority |
| ----------------------------------------- | ------------------------ | ----------- | ---------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------- | ---------------------------------- | -------- |
| Register (sign up)                        | Identity Service         | POST        | /auth/register                     | email (string), password (string), first_name (string), last_name (string), phone? (string)                                                                                           | user_id (uuid), email, created_at                                                                                                                                                    | —                                                                                            | UserRegistered                     | MVP      |
| Login                                     | Identity Service         | POST        | /auth/login                        | email (string), password (string)                                                                                                                                                     | access_token (string), refresh_token (string), expires_in (number)                                                                                                                   | —                                                                                            | —                                  | MVP      |
| Logout                                    | Identity Service         | POST        | /auth/logout                       | —                                                                                                                                                                                     | —                                                                                                                                                                                    | Authenticated                                                                                | —                                  | MVP      |
| Refresh token                             | Identity Service         | POST        | /auth/refresh                      | refresh_token (string)                                                                                                                                                                | access_token (string), expires_in (number)                                                                                                                                           | Authenticated                                                                                | —                                  | MVP      |
| Get current user (me)                     | Identity Service         | GET         | /auth/me                           | —                                                                                                                                                                                     | user_id, email, first_name, last_name, memberships[] (business_id?, provider_id?, role)                                                                                              | Authenticated                                                                                | —                                  | MVP      |
| Forgot password                           | Identity Service         | POST        | /auth/forgot-password              | email (string)                                                                                                                                                                        | —                                                                                                                                                                                    | —                                                                                            | —                                  | MVP      |
| Reset password                            | Identity Service         | POST        | /auth/reset-password               | token (string), new_password (string)                                                                                                                                                 | —                                                                                                                                                                                    | —                                                                                            | —                                  | MVP      |
| Create business                           | Business Service         | POST        | /businesses                        | legal_name (string), trading_name (string), business_type (string), tax_id? (string), address_line_1 (string), city (string), region (string), postal_code (string), country (string) | business_id (uuid), created_at                                                                                                                                                       | User (becomes BusinessOwner)                                                                 | BusinessCreated                    | MVP      |
| Get business profile                      | Business Service         | GET         | /businesses/:id                    | —                                                                                                                                                                                     | business_id, legal_name, trading_name, business_type, status, default_currency, default_delivery_address_id, created_at                                                              | BusinessOwner, BusinessManager, BusinessStaff                                                | —                                  | MVP      |
| Update business profile                   | Business Service         | PATCH       | /businesses/:id                    | legal_name?, trading_name?, business_type?, tax_id?, default_currency?                                                                                                                | business_id, updated_at                                                                                                                                                              | BusinessOwner, BusinessManager                                                               | —                                  | MVP      |
| Add delivery address                      | Business Service         | POST        | /businesses/:id/locations          | address_line_1 (string), address_line_2? (string), city (string), region (string), postal_code (string), country (string), delivery_instructions? (string)                            | location_id (uuid), created_at                                                                                                                                                       | BusinessOwner, BusinessManager, BusinessStaff                                                | —                                  | MVP      |
| Get delivery addresses                    | Business Service         | GET         | /businesses/:id/locations          | —                                                                                                                                                                                     | items[] (location_id, address_line_1, city, postal_code, country, is_default)                                                                                                        | BusinessOwner, BusinessManager, BusinessStaff                                                | —                                  | MVP      |
| Create provider                           | Provider Service         | POST        | /providers                         | legal_name (string), trading_name (string), provider_type (string), tax_id? (string), address_line_1 (string), city (string), region (string), postal_code (string), country (string) | provider_id (uuid), status, created_at                                                                                                                                               | User (becomes ProviderOwner)                                                                 | ProviderVerified                   | MVP      |
| Get provider profile                      | Provider Service         | GET         | /providers/:id                     | —                                                                                                                                                                                     | provider_id, legal_name, trading_name, provider_type, status, default_currency, created_at                                                                                           | ProviderOwner, ProviderManager, ProviderStaff                                                | —                                  | MVP      |
| Update provider profile                   | Provider Service         | PATCH       | /providers/:id                     | legal_name?, trading_name?, provider_type?, tax_id?, description?, default_currency?                                                                                                  | provider_id, updated_at                                                                                                                                                              | ProviderOwner, ProviderManager                                                               | —                                  | MVP      |
| Add product                               | Provider Service         | POST        | /providers/:id/products            | sku (string), name (string), category (string), unit (string), unit_size? (string), price (number), currency (string), tax_rate (number), description? (string)                       | product_id (uuid), created_at                                                                                                                                                        | ProviderOwner, ProviderManager, ProviderStaff                                                | ProductCreated                     | MVP      |
| Get products (catalog)                    | Provider Service         | GET         | /providers/:id/products            | cursor?, limit?                                                                                                                                                                       | items[] (product_id, sku, name, category, unit, price, currency, is_active), next_cursor                                                                                             | ProviderOwner, ProviderManager, ProviderStaff                                                | —                                  | MVP      |
| Update product                            | Provider Service         | PATCH       | /providers/:id/products/:productId | name?, category?, unit?, unit_size?, price?, tax_rate?, description?, is_active?                                                                                                      | product_id, updated_at                                                                                                                                                               | ProviderOwner, ProviderManager, ProviderStaff                                                | —                                  | MVP      |
| Add provider location                     | Provider Service         | POST        | /providers/:id/locations           | address_line_1 (string), address_line_2? (string), city (string), region (string), postal_code (string), country (string)                                                             | location_id (uuid), created_at                                                                                                                                                       | ProviderOwner, ProviderManager                                                               | —                                  | MVP      |
| Get provider locations                    | Provider Service         | GET         | /providers/:id/locations           | —                                                                                                                                                                                     | items[] (location_id, address_line_1, city, postal_code, country)                                                                                                                    | ProviderOwner, ProviderManager, ProviderStaff                                                | —                                  | MVP      |
| Search providers (discovery)              | Search/Discovery Service | GET         | /discovery/providers               | postcode? (string), radius_km? (number), category? (string), cursor?, limit?                                                                                                          | items[] (provider_id, trading_name, provider_type, rating?, distance_km?), next_cursor                                                                                               | BusinessOwner, BusinessManager, BusinessStaff                                                | —                                  | MVP      |
| Get provider public profile               | Search/Discovery Service | GET         | /discovery/providers/:id           | —                                                                                                                                                                                     | provider_id, trading_name, provider_type, description?, min_order_value?, lead_time_hours?                                                                                           | BusinessOwner, BusinessManager, BusinessStaff                                                | —                                  | MVP      |
| Get provider catalog (for ordering)       | Search/Discovery Service | GET         | /discovery/providers/:id/products  | cursor?, limit?                                                                                                                                                                       | items[] (product_id, name, sku, category, unit, unit_size, price, currency)                                                                                                          | BusinessOwner, BusinessManager, BusinessStaff                                                | —                                  | MVP      |
| Place order                               | Order Service            | POST        | /buyer/orders                      | provider_id (uuid), delivery_location_id (uuid), requested_delivery_date (date), lines[] (product_id (uuid), quantity (number)), notes? (string). Header: Idempotency-Key             | order_id (uuid), order_number (string), status, total, currency, created_at                                                                                                          | BusinessOwner, BusinessManager, BusinessStaff                                                | OrderPlaced                        | MVP      |
| Get my orders (buyer)                     | Order Service            | GET         | /buyer/orders                      | status?, cursor?, limit?                                                                                                                                                              | items[] (order_id, order_number, provider_id, status, total, requested_delivery_date, created_at), next_cursor                                                                       | BusinessOwner, BusinessManager, BusinessStaff                                                | —                                  | MVP      |
| Get order by id (buyer)                   | Order Service            | GET         | /buyer/orders/:id                  | —                                                                                                                                                                                     | order_id, order_number, provider_id, delivery_location_id, status, lines[], subtotal, tax_total, total, currency, requested_delivery_date, notes, created_at                         | BusinessOwner, BusinessManager, BusinessStaff                                                | —                                  | MVP      |
| Confirm order                             | Order Service            | POST        | /provider/orders/:id/confirm       | internal_notes? (string)                                                                                                                                                              | order_id, status (confirmed), confirmed_at                                                                                                                                           | ProviderOwner, ProviderManager, ProviderStaff                                                | OrderConfirmed                     | MVP      |
| Reject order                              | Order Service            | POST        | /provider/orders/:id/reject        | reason? (string)                                                                                                                                                                      | order_id, status (cancelled)                                                                                                                                                         | ProviderOwner, ProviderManager, ProviderStaff                                                | —                                  | MVP      |
| Update order status (preparing, shipped)  | Order Service            | PATCH       | /provider/orders/:id               | status (preparing \| shipped), internal_notes? (string)                                                                                                                               | order_id, status, updated_at                                                                                                                                                         | ProviderOwner, ProviderManager, ProviderStaff                                                | OrderPrepared, OrderDispatched     | MVP      |
| Cancel order (buyer)                      | Order Service            | POST        | /buyer/orders/:id/cancel           | reason? (string)                                                                                                                                                                      | order_id, status (cancelled)                                                                                                                                                         | BusinessOwner, BusinessManager, BusinessStaff                                                | —                                  | MVP      |
| Get my orders (provider)                  | Order Service            | GET         | /provider/orders                   | status?, cursor?, limit?                                                                                                                                                              | items[] (order_id, order_number, business_id, status, total, requested_delivery_date, created_at), next_cursor                                                                       | ProviderOwner, ProviderManager, ProviderStaff                                                | —                                  | MVP      |
| Get order by id (provider)                | Order Service            | GET         | /provider/orders/:id               | —                                                                                                                                                                                     | order_id, order_number, business_id, delivery_location (snapshot), status, lines[], subtotal, tax_total, total, currency, requested_delivery_date, notes, internal_notes, created_at | ProviderOwner, ProviderManager, ProviderStaff                                                | —                                  | MVP      |
| Update delivery status                    | Logistics Service        | PATCH       | /deliveries/:id                    | status (scheduled \| picked_up \| in_transit \| delivered \| failed), tracking_code? (string), estimated_delivery_at? (datetime), actual_delivery_at? (datetime)                      | delivery_id, order_id, status, updated_at                                                                                                                                            | ProviderOwner, ProviderManager, ProviderStaff                                                | OrderDelivered (when delivered)    | MVP      |
| Get delivery (tracking)                   | Logistics Service        | GET         | /deliveries/:id                    | —                                                                                                                                                                                     | delivery_id, order_id, status, tracking_code, estimated_delivery_at, actual_delivery_at, updated_at                                                                                  | BusinessOwner, BusinessManager, BusinessStaff; ProviderOwner, ProviderManager, ProviderStaff | —                                  | MVP      |
| Create and issue invoice                  | Payment Service          | POST        | /invoices                          | order_id (uuid)                                                                                                                                                                       | invoice_id (uuid), invoice_number (string), order_id, total, currency, status (issued), due_date, issued_at                                                                          | ProviderOwner, ProviderManager, ProviderStaff                                                | InvoiceGenerated                   | MVP      |
| List invoices (buyer)                     | Payment Service          | GET         | /buyer/invoices                    | status?, cursor?, limit?                                                                                                                                                              | items[] (invoice_id, invoice_number, provider_id, total, currency, status, due_date, issued_at), next_cursor                                                                         | BusinessOwner, BusinessManager, BusinessStaff                                                | —                                  | MVP      |
| List invoices (provider)                  | Payment Service          | GET         | /provider/invoices                 | status?, cursor?, limit?                                                                                                                                                              | items[] (invoice_id, invoice_number, business_id, total, currency, status, due_date, issued_at), next_cursor                                                                         | ProviderOwner, ProviderManager, ProviderStaff                                                | —                                  | MVP      |
| Get invoice by id                         | Payment Service          | GET         | /invoices/:id                      | —                                                                                                                                                                                     | invoice_id, invoice_number, provider_id, business_id, order_id, subtotal, tax_total, total, currency, status, due_date, issued_at, lines[]                                           | BusinessOwner, BusinessManager, BusinessStaff; ProviderOwner, ProviderManager, ProviderStaff | —                                  | MVP      |
| Pay invoice (initiate payment)            | Payment Service          | POST        | /invoices/:id/payments             | return_url (string), cancel_url? (string). Header: Idempotency-Key                                                                                                                    | payment_id (uuid), checkout_url (string) (redirect to gateway)                                                                                                                       | BusinessOwner, BusinessManager, BusinessStaff                                                | PaymentInitiated, PaymentCompleted | MVP      |
| Get payments (list)                       | Payment Service          | GET         | /payments                          | payable_type? (invoice), payable_id?, cursor?, limit?                                                                                                                                 | items[] (payment_id, payable_type, payable_id, amount, currency, status, paid_at, created_at), next_cursor                                                                           | BusinessOwner, BusinessManager, BusinessStaff; ProviderOwner, ProviderManager, ProviderStaff | —                                  | MVP      |
| Submit rating (data collection)           | Trust Service            | POST        | /orders/:id/ratings                | rating (number 1-5), comment? (string)                                                                                                                                                | rating_id (uuid), order_id, provider_id, rating, created_at                                                                                                                          | BusinessOwner, BusinessManager, BusinessStaff                                                | RatingSubmitted                    | MVP      |
| List users                                | Admin Service            | GET         | /admin/users                       | status?, cursor?, limit?                                                                                                                                                              | items[] (user_id, email, first_name, last_name, status, created_at), next_cursor                                                                                                     | PlatformAdmin, PlatformOps                                                                   | —                                  | MVP      |
| List businesses                           | Admin Service            | GET         | /admin/businesses                  | status?, cursor?, limit?                                                                                                                                                              | items[] (business_id, legal_name, trading_name, business_type, status, created_at), next_cursor                                                                                      | PlatformAdmin, PlatformOps                                                                   | —                                  | MVP      |
| List providers                            | Admin Service            | GET         | /admin/providers                   | status?, cursor?, limit?                                                                                                                                                              | items[] (provider_id, legal_name, trading_name, provider_type, status, created_at), next_cursor                                                                                      | PlatformAdmin, PlatformOps                                                                   | —                                  | MVP      |
| Update user status (active/suspended)     | Identity Service         | PATCH       | /admin/users/:id                   | status (active \| suspended)                                                                                                                                                          | user_id, status, updated_at                                                                                                                                                          | PlatformAdmin, PlatformOps                                                                   | —                                  | MVP      |
| Update business status (active/suspended) | Business Service         | PATCH       | /admin/businesses/:id              | status (active \| suspended)                                                                                                                                                          | business_id, status, updated_at                                                                                                                                                      | PlatformAdmin, PlatformOps                                                                   | —                                  | MVP      |
| Update provider status (active/suspended) | Provider Service         | PATCH       | /admin/providers/:id               | status (active \| suspended \| pending_verification)                                                                                                                                  | provider_id, status, updated_at                                                                                                                                                      | PlatformAdmin, PlatformOps                                                                   | ProviderVerified (when set active) | MVP      |
| Execute payout (manual)                   | Payment Service          | POST        | /admin/payouts                     | provider_id (uuid), amount? (number), currency? (string). Header: Idempotency-Key                                                                                                     | payout_id (uuid), provider_id, amount, currency, status, executed_at                                                                                                                 | PlatformAdmin, PlatformFinance                                                               | PayoutExecuted                     | MVP      |

---

## Excluded (no endpoint)

| Capability                                 | Reason                                                                                               |
| ------------------------------------------ | ---------------------------------------------------------------------------------------------------- |
| Resolve principal (internal)               | Middleware / internal; no client endpoint.                                                           |
| Create delivery (on order confirm)         | System action on OrderConfirmed; implemented by Logistics consumer or Order→Logistics internal call. |
| Deliver notification (email, event-driven) | Event consumer only; no client API.                                                                  |

---

## Notes

- **Scope:** Buyer endpoints (`/buyer/orders`, `/buyer/invoices`) resolve `business_id` from the authenticated user’s membership. Provider endpoints (`/provider/orders`, `/provider/invoices`) resolve `provider_id` from membership. Admin endpoints require platform role.
- **Delivery by order:** Client can resolve delivery for an order via `GET /orders/:id` (include `delivery` in response) or `GET /deliveries?order_id=:id`; Logistics may expose `GET /orders/:id/delivery` as alias. Table uses `GET /deliveries/:id` (delivery_id from order response or list).
- **PaymentCompleted:** Emitted when gateway webhook is processed; not by the initiate-payment call itself.
- **Idempotency-Key:** Required on POST /buyer/orders, POST /invoices/:id/payments, POST /admin/payouts to avoid duplicate orders/payments/payouts on retry.
